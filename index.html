<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doorman Humanoid Research Demo</title>
    <style>
        @font-face {
            font-family: 'NVIDIA Sans';
            src: url('font/NVIDIASansVF_NALA_W_Wght.woff2') format('woff2');
            font-weight: 100 900;
            font-display: swap;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'NVIDIA Sans', 'Arial', sans-serif;
            background: #000;
            color: white;
            overflow-x: hidden;
        }

        .background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            width: 100vw;
            height: 100vh;
            /* Prevent resize when mobile browser chrome hides/shows */
            height: 100svh; /* Use small viewport height on supporting browsers */
            object-fit: cover;
        }

        @supports (-webkit-touch-callout: none) {
            /* iOS specific: use -webkit-fill-available */
            .background-canvas {
                height: -webkit-fill-available;
            }
        }

        .content {
            position: relative;
            z-index: 1;
            height: 1000vh; /* Extended height for two video sequences */
        }

        .dark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            opacity: 0;
            z-index: 1;
            pointer-events: none;
        }

        .title-section {
            position: fixed;
            top: 50%;
            left: 10%;
            transform: translateY(-50%);
            text-align: left;
            opacity: 0;
            z-index: 2;
            display: flex;
            align-items: flex-start;
        }

        .title-section-2 {
            position: fixed;
            top: 50%;
            left: 10%;
            transform: translateY(-50%);
            text-align: left;
            opacity: 0;
            z-index: 2;
            display: flex;
            align-items: flex-start;
        }

        .vertical-bar {
            width: 10px;
            height: 9rem;
            background: #76b900;
            margin-right: 2rem;
        }

        .title-content {
            display: flex;
            flex-direction: column;
        }

        .main-title {
            font-size: 4rem;
            font-weight: 500;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.8rem;
            font-weight: 300;
            letter-spacing: 0.5px;
            opacity: 0.9;
        }

        .scroll-indicator {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            z-index: 3;
        }

        .header-title {
            position: fixed;
            top: 2rem;
            font-size: 1.2rem;
            font-weight: 400;
            letter-spacing: 1px;
            z-index: 3;
            color: white;
        }

        .header-left {
            left: 3rem;
        }

        .header-right {
            right: 3rem;
        }

        .video-container {
            position: fixed;
            right: 5%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            opacity: 0;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .video-container video {
            width: 600px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .static-sections {
            position: relative;
            z-index: 2;
            background: transparent;
            padding: 20px 0;
        }

        .section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 40px;
        }

        .paper-title-section {
            text-align: left;
            padding: 96px 32px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .paper-title {
            font-size: 2.7rem;
            font-weight: 400;
            line-height: 1.4;
            margin-bottom: 2.4rem;
        }

        .paper-title .doorman {
            display: block;
            color: #76b900;
            font-size: 3.6rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
        }

        .authors {
            font-size: 1rem;
            font-weight: 300;
            line-height: 2;
            color: rgba(255, 255, 255, 0.8);
            max-width: 720px;
        }

        .authors a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .authors a:hover {
            color: #76b900;
            text-decoration: underline;
        }

        .logos-section {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 2rem;
            margin-top: 2.4rem;
        }

        .logo-separator {
            width: 1px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
        }

        .logos-section img {
            height: 40px;
            width: auto;
            object-fit: contain;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }

        .logos-section img:hover {
            opacity: 1;
        }

        .logos-section img.logo-smaller {
            height: 32px;
        }

        .logos-section img.logo-larger {
            height: 42px;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 500;
            margin-bottom: 2rem;
            color: #76b900;
        }

        .bootstrap-text {
            display: inline-block;
            position: relative;
            font-weight: 700;
            opacity: 0;
            transform: translateX(-20px);
            background: linear-gradient(120deg, #76b900, #a8e063, #56ab2f, #76b900);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            filter: brightness(1.2);
            margin-left: 0.15em;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bootstrap-text::before {
            content: 'Bootstrap';
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            background: linear-gradient(120deg, #76b900, #a8e063, #56ab2f, #76b900);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            filter: brightness(1.2);
        }

        .bootstrap-text.glitch::before {
            animation: glitch 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both, gradientShift 4s ease infinite;
        }

        @keyframes glitch {
            0%, 100% {
                transform: translate(0);
                opacity: 0;
            }
            20% {
                transform: translate(-2px, 2px);
                opacity: 0.8;
            }
            40% {
                transform: translate(2px, -2px);
                opacity: 0.8;
            }
            60% {
                transform: translate(-2px, -2px);
                opacity: 0.8;
            }
            80% {
                transform: translate(2px, 2px);
                opacity: 0.8;
            }
        }

        .section-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 2rem;
        }

        .placeholder-image {
            width: 100%;
            height: 400px;
            background: #2a2a2a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.2rem;
        }

        .video-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            width: 100%;
        }

        .video-grid video {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .tsb-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            margin-top: 3rem;
        }

        .tsb-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .tsb-item:has(.icon-container) {
            flex: 0 0 80px;
        }

        .tsb-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .tsb-label {
            margin-top: 1rem;
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.75);
            text-align: center;
            line-height: 1.4;
            max-width: 200px;
        }

        .placeholder-figure {
            min-height: 300px;
            width: 100%;
            background: #2a2a2a;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tsb-video {
            width: 100%;
            aspect-ratio: 16 / 9;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .tsb-placeholder {
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #2a2a2a;
            border-radius: 8px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }

        .icon-container {
            flex: 0 0 auto;
        }

        .icon-container svg,
        .icon-container img {
            width: 64px;
            height: 64px;
        }

        .beaker-icon {
            transform-box: fill-box;
            transform-origin: 50% 20%;
        }

        .bibtex-section {
            background: transparent;
            padding: 80px 40px;
        }

        .bibtex-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .bibtex-code {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 2rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #76b900;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .title-section {
                left: 5%;
            }
            .vertical-bar {
                height: 6rem;
                margin-right: 1rem;
            }
            .main-title {
                font-size: 2.5rem;
            }
            .subtitle {
                font-size: 1.2rem;
            }
            .header-title {
                font-size: 1rem;
                top: 1.5rem;
            }
            .header-left {
                left: 1.5rem;
            }
            .header-right {
                right: 1.5rem;
            }
            .video-container video {
                width: 300px;
            }
            .title-section-2 {
                left: 5%;
                top: 25%;
                transform: translateY(-50%);
            }
            .video-container {
                left: 5%;
                right: 5%;
                top: 60%;
                transform: translateY(-50%);
                gap: 1rem;
            }
            .paper-title {
                font-size: 1.6rem;
            }
            .paper-title .doorman {
                font-size: 2.3rem;
            }
            .authors {
                font-size: 0.85rem;
            }
            .section-title {
                font-size: 1.8rem;
            }
            .section {
                padding: 60px 20px;
            }
            .logos-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
            .logos-section img {
                height: 28px;
            }
            .logos-section img.logo-smaller {
                height: 22px;
            }
            .logos-section img.logo-larger {
                height: 30px;
            }
            .logo-separator {
                display: none;
            }
            .video-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .tsb-flow {
                flex-direction: column;
                gap: 3rem;
            }
            .placeholder-figure {
                min-height: 200px;
                width: 100%;
            }
            .icon-container svg,
            .icon-container img {
                width: 48px;
                height: 48px;
            }
            .tsb-label {
                font-size: 0.85rem;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <canvas id="background-canvas" class="background-canvas"></canvas>

    <div class="dark-overlay" id="dark-overlay"></div>

    <div class="header-title header-left">DoorMan</div>
    <div class="header-title header-right">NVIDIA GEAR Team</div>

    <div class="content">
        <div class="title-section" id="title-section">
            <div class="vertical-bar"></div>
            <div class="title-content">
                <h1 class="main-title">Infinite Visual<br>Randomizations</h1>
                <p class="subtitle">Powered by IsaacLab</p>
            </div>
        </div>
        <div class="title-section-2" id="title-section-2">
            <div class="vertical-bar"></div>
            <div class="title-content">
                <h1 class="main-title">Robust Policy<br>Transfer</h1>
                <p class="subtitle">RGB Sim-to-Real</p>
            </div>
        </div>

        <div class="video-container" id="video-container">
            <video autoplay muted loop playsinline controls>
                <source src="media/demos_loc_2/Door 1 Multi View.mp4" type="video/mp4">
            </video>
            <video autoplay muted loop playsinline controls>
                <source src="media/demos_loc_2/Door 2 Multi View.mp4" type="video/mp4">
            </video>
        </div>
    </div>

    <div class="scroll-indicator" id="scroll-indicator">
        Scroll to explore
    </div>

    <!-- Static Sections -->
    <div class="static-sections">
        <!-- Paper Title Section -->
        <div class="paper-title-section">
            <h1 class="paper-title">
                <span class="doorman">DoorMan</span>
                Opening the Sim-to-Real Door for<br>Humanoid Pixel-to-Action Policy Transfer
            </h1>
            <div class="authors">
                <a href="https://haoruxue.github.io/">Haoru Xue</a><sup>1,2,*</sup>,
                <a href="https://tairanhe.com/">Tairan He</a><sup>1,3,*</sup>,
                <a href="https://ziwang1105.github.io/">Zi Wang</a><sup>1,*</sup>,
                <a href="https://www.qingweiben.com/">Qingwei Ben</a><sup>1,4,*</sup>,<br>
                <a href="https://www.wenlixiao.com/">Wenli Xiao</a><sup>1,3</sup>,
                <a href="https://www.zhengyiluo.com/">Zhengyi Luo</a><sup>1</sup>,
                <a href="https://www.linkedin.com/in/xingye-dennis-da-86242655/">Xingye Da</a><sup>1</sup>,
                <a href="https://scholar.google.com/citations?user=U9WUBC4AAAAJ&hl=es">Fernando Castañeda</a><sup>1</sup>,<br>
                <a href="https://www.gshi.me/">Guanya Shi</a><sup>3</sup>,
                <a href="https://people.eecs.berkeley.edu/~sastry/">Shankar Sastry</a><sup>2</sup>,
                <a href="https://jimfan.me/">Linxi "Jim" Fan</a><sup>1,†</sup>,
                <a href="https://yukezhu.me/">Yuke Zhu</a><sup>1,†</sup>
                <br><br>
                <sup>1</sup>NVIDIA, <sup>2</sup>UC Berkeley, <sup>3</sup>CMU, <sup>4</sup>CUHK<br>
                <sup>*</sup>Equal Contribution, <sup>†</sup>Project Leads
            </div>
            <div class="logos-section">
                <img src="media/logos/nvidia_logo.png" alt="NVIDIA" class="logo-smaller">
                <div class="logo-separator"></div>
                <img src="media/logos/uc_berkeley_logo.png" alt="UC Berkeley" class="logo-smaller">
                <div class="logo-separator"></div>
                <img src="media/logos/cmu-wordmark-horizontal-w.png" alt="CMU" class="logo-smaller">
                <div class="logo-separator"></div>
                <img src="media/logos/cuhk_logo.png" alt="CUHK" class="logo-larger">
            </div>
        </div>

        <!-- Method Section -->
        <div class="section">
            <h2 class="section-title">Mass Scale Simulation Randomization</h2>
            <div class="section-content">
                <p>We use a procedural generation pipeline that randomizes physical and visual properties of articulated objects: mass, handle type, hinge damping, stiffness, texture, background, etc.</p>
            </div>
            <div class="video-grid">
                <video autoplay muted loop playsinline>
                    <source src="media/sim/Sim Doors.mp4" type="video/mp4">
                </video>
                <video autoplay muted loop playsinline>
                    <source src="media/sim/doors_1080.mp4" type="video/mp4">
                </video>
            </div>
        </div>

        <!-- Result Section -->
        <div class="section" id="results-section">
            <h2 class="section-title">Teacher-Student-<span class="bootstrap-text">Bootstrap</span></h2>
            <div class="section-content">
                <p>We apply GRPO fine-tuning to bootstrap the student on top of classical teacher-student distillation. We find this stage to be uniquely useful for challenging loco-manipulation tasks due to partial observability. The reward is mostly binary on the task success criteria. The result: 20-30% success rate improvement.</p>
            </div>
            <div class="tsb-flow">
                <div class="tsb-item">
                    <div class="tsb-content">
                        <video class="tsb-video" autoplay muted loop playsinline>
                            <source src="media/pull_solid_door_no_texture_fixed_cam_exported.mp4" type="video/mp4">
                        </video>
                        <div class="tsb-label">Phase 1: Train privileged teacher with PPO</div>
                    </div>
                </div>
                <div class="tsb-item">
                    <div class="tsb-content">
                        <div class="icon-container" id="beaker-icon">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g class="beaker-icon">
                                    <!-- Hollow white bubbles -->
                                    <circle class="bubble" cx="17" cy="31" r="1.2" stroke="white" stroke-width="1" fill="none" />
                                    <circle class="bubble" cx="19" cy="27" r="1.2" stroke="white" stroke-width="1" fill="none" />
                                    <circle class="bubble" cx="21" cy="34" r="1.2" stroke="white" stroke-width="1" fill="none" />

                                    <!-- Main beaker path in white -->
                                    <g clip-path="url(#clip0_24_403)">
                                        <path d="M23.499 11.5H24.999V8.5H15.5V11.5H17L16.999 20.8594L8.38525 34.9453L9.61475 39.5H30.3828L31.6104 34.9531L23.5 20.8662L23.499 11.5ZM16.5 10.5V9.5H23.999V10.5H22.499L22.4997 17.5H17.9993L18 10.5H16.5ZM29.6172 38.5H10.3804L9.46237 35.1001L17.999 21.1406L17.9993 18.5H22.4998L22.5 21.1338L24.4382 24.5H22.5V25.5H25.0139L26.1655 27.5H23.5V28.5H26.7412L27.8928 30.5H24.5V31.5H28.4685L29.6201 33.5H25.5V34.5H30.1958L30.5371 35.0928L29.6172 38.5ZM39.5 13.5V10.5H32.5V13.5H33.5L33.499 35C33.499 35.6632 33.7624 36.2992 34.2314 36.7681C34.7003 37.2371 35.3363 37.5005 35.9995 37.5005C36.6627 37.5005 37.2987 37.2371 37.7676 36.7681C38.2366 36.2992 38.5 35.6632 38.5 35V34.5V33.5L38.4998 31.5H38.5V30.5H38.4998V28.5H38.5V27.5H38.4996L38.4995 25.5H38.5V24.5H38.4995V22.5H38.5V21.5H38.4994L38.4993 19.5H38.5V18.5H38.4993L38.4992 16.5H38.5V15.5H38.499V13.5H39.5ZM37.4993 16.5V18.5H36.5V19.5H37.4993L37.4994 21.5H36.5V22.5H37.4995V24.5H36.5V25.5H37.4995L37.4998 27.5H36.5V28.5H37.4998V30.5H36.5V31.5H37.4999L37.5 33.5H36.5V34.5H37.5V35C37.5 35.398 37.3419 35.7796 37.0605 36.061C36.7791 36.3424 36.3975 36.5005 35.9995 36.5005C35.6015 36.5005 35.2199 36.3424 34.9385 36.061C34.6571 35.7796 34.499 35.398 34.499 35L34.5 12.5H33.5V11.5H38.5V12.5H37.499L37.4991 15.5H36.5V16.5H37.4993Z" fill="white"/>
                                    </g>
                                </g>

                                <defs>
                                    <clipPath id="clip0_24_403">
                                        <rect width="48" height="48" fill="none"/>
                                    </clipPath>
                                </defs>
                            </svg>
                        </div>
                        <div class="tsb-label">Distill</div>
                    </div>
                </div>
                <div class="tsb-item">
                    <div class="tsb-content">
                        <video class="tsb-video" autoplay muted loop playsinline>
                            <source src="media/Sim Pull Open Door Fixed Angle.mp4" type="video/mp4">
                        </video>
                        <div class="tsb-label">Phase 2: Distill onto vision student with DAgger</div>
                    </div>
                </div>
                <div class="tsb-item">
                    <div class="tsb-content">
                        <div class="icon-container" id="copy-icon">
                            <img src="media/icons/copy.svg" alt="Copy icon">
                        </div>
                        <div class="tsb-label">Copy initialize</div>
                    </div>
                </div>
                <div class="tsb-item">
                    <div class="tsb-content">
                        <div class="tsb-placeholder"></div>
                        <div class="tsb-label">Phase 3: Fine-tune student with GRPO</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Failure Cases Section -->
        <div class="section">
            <h2 class="section-title">Failure Cases</h2>
            <div class="section-content">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
            </div>
            <div class="placeholder-image">[Failure Cases Video Placeholder]</div>
        </div>
    </div>

    <!-- BibTeX Section -->
    <div class="bibtex-section">
        <div class="bibtex-container">
            <h2 class="section-title">Citation</h2>
            <pre class="bibtex-code">@article{doorman2024,
  title={DoorMan: Opening the Sim-to-Real Door for Humanoid Pixel-to-Action Policy Transfer},
  author={Author One and Author Two and Author Three and others},
  journal={arXiv preprint arXiv:XXXX.XXXXX},
  year={2024}
}</pre>
        </div>
    </div>

    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <script>
        // Register ScrollTrigger plugin
        gsap.registerPlugin(ScrollTrigger);

        // Get canvas and context
        const canvas = document.getElementById('background-canvas');
        const context = canvas.getContext('2d');
        const titleSection = document.getElementById('title-section');
        const titleSection2 = document.getElementById('title-section-2');
        const scrollIndicator = document.getElementById('scroll-indicator');
        const darkOverlay = document.getElementById('dark-overlay');
        const videoContainer = document.getElementById('video-container');

        // Detect mobile device
        const isMobile = window.innerWidth <= 768;

        // On mobile, capture initial viewport height to prevent resize when browser chrome hides/shows
        const initialHeight = window.innerHeight;
        const viewportHeight = isMobile ? initialHeight : window.innerHeight;

        // Set canvas size to match viewport with device pixel ratio for sharp rendering
        // Use 1x DPR on mobile to reduce memory, 2x max on desktop
        const dpr = isMobile ? 1 : Math.min(window.devicePixelRatio || 1, 2);

        // Cap canvas dimensions to prevent excessive memory usage
        const maxDimension = isMobile ? 1920 : 3840;
        const canvasWidth = Math.min(window.innerWidth * dpr, maxDimension);
        const canvasHeight = Math.min(viewportHeight * dpr, maxDimension);

        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        canvas.style.width = window.innerWidth + 'px';
        canvas.style.height = viewportHeight + 'px';

        // Handle window resize
        let resizeTimeout;
        let lastWidth = window.innerWidth;

        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                const currentWidth = window.innerWidth;
                const isMobile = currentWidth <= 768;

                // On mobile, only resize if width changed (rotation), ignore height changes (browser chrome)
                if (isMobile && currentWidth === lastWidth) {
                    return;
                }

                lastWidth = currentWidth;

                const viewportHeight = isMobile ? initialHeight : window.innerHeight;
                const dpr = isMobile ? 1 : Math.min(window.devicePixelRatio || 1, 2);
                const maxDimension = isMobile ? 1920 : 3840;
                const canvasWidth = Math.min(currentWidth * dpr, maxDimension);
                const canvasHeight = Math.min(viewportHeight * dpr, maxDimension);

                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                canvas.style.width = currentWidth + 'px';
                canvas.style.height = viewportHeight + 'px';
                render(); // Re-render at new size
            }, 250); // Debounce resize events
        });

        // First video sequence configuration (Pull Door)
        // Use more aggressive subsampling on mobile to reduce memory
        const subsampleFactor = isMobile ? 4 : 2; // Every 4th frame on mobile, every 2nd on desktop
        const frameCount1 = Math.floor(288 / subsampleFactor); // Subsampled frame count
        const frameOffset1 = 4; // Start from frame 4
        const getFrame1 = index => {
            const frameNum = (index * subsampleFactor) + frameOffset1;
            return `media/frames_pull_door/frame_${frameNum.toString().padStart(4, '0')}.jpg`;
        };

        // Second video sequence configuration (Push Door)
        const frameCount2 = Math.floor(278 / subsampleFactor); // Subsampled frame count
        const frameOffset2 = 4; // Start from frame 4
        const getFrame2 = index => {
            const frameNum = (index * subsampleFactor) + frameOffset2;
            return `media/frames_push_door/frame_${frameNum.toString().padStart(4, '0')}.jpg`;
        };

        // Load all images for both sequences
        const images1 = [];
        const images2 = [];
        let imagesLoaded = false;

        // Create loading promises for both sequences
        const loadPromises = [];

        for (let i = 0; i < frameCount1; i++) {
            const img = new Image();
            const promise = new Promise((resolve) => {
                img.onload = resolve;
                img.onerror = resolve; // Still resolve on error to not block
            });
            img.src = getFrame1(i);
            images1.push(img);
            loadPromises.push(promise);
        }

        for (let i = 0; i < frameCount2; i++) {
            const img = new Image();
            const promise = new Promise((resolve) => {
                img.onload = resolve;
                img.onerror = resolve; // Still resolve on error to not block
            });
            img.src = getFrame2(i);
            images2.push(img);
            loadPromises.push(promise);
        }

        const doorman = {
            progress: 0
        };

        // Wait for all images to load before starting animation
        Promise.all(loadPromises).then(() => {
            console.log('All images loaded successfully');
            imagesLoaded = true;
            render(); // Initial render

            // Single unified scroll animation
            gsap.to(doorman, {
                progress: 1,
                ease: "none",
                scrollTrigger: {
                    trigger: ".content",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 0.5
                },
                onUpdate: render
            });
        });

        // Helper function to draw image covering the entire canvas (like CSS background-size: cover)
        function drawImageCover(img) {
            const imgRatio = img.width / img.height;
            const canvasRatio = canvas.width / canvas.height;

            let drawWidth, drawHeight, offsetX = 0, offsetY = 0;

            if (imgRatio > canvasRatio) {
                // Image is wider than canvas
                drawHeight = canvas.height;
                drawWidth = img.width * (canvas.height / img.height);
                offsetX = (canvas.width - drawWidth) / 2;
            } else {
                // Image is taller than canvas
                drawWidth = canvas.width;
                drawHeight = img.height * (canvas.width / img.width);
                offsetY = (canvas.height - drawHeight) / 2;
            }

            context.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
        }

        // Render function based on overall scroll progress
        function render() {
            if (!imagesLoaded) {
                console.log('Images not loaded yet, skipping render');
                return;
            }

            context.clearRect(0, 0, canvas.width, canvas.height);

            const p = doorman.progress;

            // First sequence: 0-0.40 (plays video)
            // Pause/hold: 0.40-0.48 (holds last frame of first video)
            // Crossfade: 0.48-0.52 (crossfade between videos)
            // Second sequence: 0.52-0.90 (plays second video)
            // Hold: 0.90-1.0 (holds last frame of second video)

            if (p <= 0.40) {
                // Play first video
                const frame = Math.round((p / 0.40) * (frameCount1 - 1));
                context.globalAlpha = 1;
                drawImageCover(images1[frame]);
            } else if (p > 0.40 && p <= 0.48) {
                // Hold last frame of first video
                context.globalAlpha = 1;
                drawImageCover(images1[frameCount1 - 1]);
            } else if (p > 0.48 && p < 0.52) {
                // Crossfade transition
                const fadeProgress = (p - 0.48) / 0.04; // 0 to 1 over the transition
                console.log(`Crossfade progress: ${p.toFixed(3)}, fade: ${fadeProgress.toFixed(3)}`);

                // Draw first video last frame fading out
                context.globalAlpha = 1 - fadeProgress;
                drawImageCover(images1[frameCount1 - 1]);

                // Draw second video first frame fading in
                context.globalAlpha = fadeProgress;
                drawImageCover(images2[0]);

                context.globalAlpha = 1;
            } else if (p >= 0.52 && p <= 0.90) {
                // Play second video
                const frame = Math.round(((p - 0.52) / 0.38) * (frameCount2 - 1));
                context.globalAlpha = 1;
                drawImageCover(images2[frame]);
            } else {
                // Hold last frame of second video
                context.globalAlpha = 1;
                drawImageCover(images2[frameCount2 - 1]);
            }
        }

        /* ---------------------------------- */
        /* Title and Overlay Animations */

        // Set initial states
        gsap.set(darkOverlay, { opacity: 0 });
        gsap.set(titleSection, { opacity: 0 });
        gsap.set(titleSection2, { opacity: 0 });
        gsap.set(videoContainer, { opacity: 0 });
        gsap.set("#title-section .main-title", { x: -30, opacity: 0 });
        gsap.set("#title-section .subtitle", { x: -20, opacity: 0 });
        gsap.set("#title-section-2 .main-title", { x: -30, opacity: 0 });
        gsap.set("#title-section-2 .subtitle", { x: -20, opacity: 0 });

        // First title section fade in (35%-37% scroll)
        gsap.to(titleSection, {
            opacity: 1,
            scrollTrigger: {
                trigger: ".content",
                start: "35% bottom",
                end: "37% bottom",
                scrub: true
            }
        });

        gsap.to("#title-section .main-title", {
            x: 0,
            opacity: 1,
            scrollTrigger: {
                trigger: ".content",
                start: "35% bottom",
                end: "37% bottom",
                scrub: true
            }
        });

        gsap.to("#title-section .subtitle", {
            x: 0,
            opacity: 0.9,
            scrollTrigger: {
                trigger: ".content",
                start: "35% bottom",
                end: "37% bottom",
                scrub: true
            }
        });

        // First title section fade out (43%-45% scroll)
        gsap.to(titleSection, {
            opacity: 0,
            scrollTrigger: {
                trigger: ".content",
                start: "43% top",
                end: "45% top",
                scrub: true
            }
        });

        // Second overlay fade in (85%-87% scroll)
        gsap.to(darkOverlay, {
            opacity: 1,
            scrollTrigger: {
                trigger: ".content",
                start: "85% bottom",
                end: "87% bottom",
                scrub: true
            }
        });

        // Second title section fade in (85%-87% scroll)
        gsap.to(titleSection2, {
            opacity: 1,
            scrollTrigger: {
                trigger: ".content",
                start: "85% bottom",
                end: "87% bottom",
                scrub: true
            }
        });

        gsap.to("#title-section-2 .main-title", {
            x: 0,
            opacity: 1,
            scrollTrigger: {
                trigger: ".content",
                start: "85% bottom",
                end: "87% bottom",
                scrub: true
            }
        });

        gsap.to("#title-section-2 .subtitle", {
            x: 0,
            opacity: 0.9,
            scrollTrigger: {
                trigger: ".content",
                start: "85% bottom",
                end: "87% bottom",
                scrub: true
            }
        });

        // Video container fade in (85%-87% scroll) - same timing as title-section-2
        gsap.to(videoContainer, {
            opacity: 1,
            scrollTrigger: {
                trigger: ".content",
                start: "85% bottom",
                end: "87% bottom",
                scrub: true
            }
        });

        // Second title section fade out (95%-97% scroll)
        gsap.to(titleSection2, {
            opacity: 0,
            scrollTrigger: {
                trigger: ".content",
                start: "95% bottom",
                end: "97% bottom",
                scrub: true
            }
        });

        // Video container fade out (95%-97% scroll)
        gsap.to(videoContainer, {
            opacity: 0,
            scrollTrigger: {
                trigger: ".content",
                start: "95% bottom",
                end: "97% bottom",
                scrub: true
            }
        });

        // Scroll indicator fade out (95%-97% scroll) - hide when paper title section appears
        gsap.to(scrollIndicator, {
            opacity: 0,
            scrollTrigger: {
                trigger: ".content",
                start: "95% bottom",
                end: "97% bottom",
                scrub: true,
                onComplete: () => { scrollIndicator.style.display = 'none'; },
                onReverseComplete: () => { scrollIndicator.style.display = 'block'; }
            }
        });

        // Bootstrap text animation - slide in with glitch and gradient
        const bootstrapText = document.querySelector('.bootstrap-text');

        // Initial slide-in animation with glitch effect when section comes into view
        gsap.to(bootstrapText, {
            opacity: 1,
            x: 0,
            duration: 0.8,
            ease: "back.out(1.2)",
            scrollTrigger: {
                trigger: "#results-section",
                start: "top 80%",
                toggleActions: "play none none reverse",
                onEnter: () => {
                    // Trigger glitch effect on entry
                    bootstrapText.classList.add('glitch');
                    setTimeout(() => {
                        bootstrapText.classList.remove('glitch');
                    }, 300);
                }
            },
            onComplete: () => {
                bootstrapText.classList.add('highlight');
                // Subtle pulse effect to keep drawing attention
                gsap.to(bootstrapText, {
                    scale: 1.08,
                    duration: 2,
                    ease: "sine.inOut",
                    yoyo: true,
                    repeat: -1
                });
            }
        });

        // ========================================
        // Beaker Icon Animations
        // ========================================

        // Bubble jitter animation - subtle continuous boiling effect
        gsap.to("#beaker-icon .bubble", {
            x: "random(-0.7, 0.7)",
            y: "random(-0.7, 0.7)",
            duration: 0.3,
            yoyo: true,
            repeat: -1,
            ease: "sine.inOut",
            stagger: {
                each: 0.1,
                repeat: -1,
                yoyo: true
            }
        });

        // Realistic beaker shake animation - simulates hand shaking (slowed to 0.5x speed)
        const distillShake = gsap.timeline({
            repeat: -1,
            repeatDelay: 0.6,
            paused: false,  // Auto-start
            defaults: { ease: "power2.inOut" }
        });

        distillShake
            .to("#beaker-icon .beaker-icon", { rotation: -3, x: -0.8, duration: 0.12 })
            .to("#beaker-icon .beaker-icon", { rotation: 4,  x:  1.0, duration: 0.12 })
            .to("#beaker-icon .beaker-icon", { rotation: -2, x: -0.6, duration: 0.10 })
            .to("#beaker-icon .beaker-icon", { rotation: 2,  x:  0.4, duration: 0.10 })
            .to("#beaker-icon .beaker-icon", { rotation: 0,  x:  0,   duration: 0.36, ease: "power3.out" });

        // Optional: API to control distillation animation
        window.beakerAnimation = {
            start: () => distillShake.play(),
            stop: () => distillShake.pause(0)
        };

        // ========================================
        // Copy Icon File Translation Animation
        // ========================================

        // Load external SVG inline so we can animate it
        const copyIconContainer = document.querySelector("#copy-icon");
        const copyIconImg = copyIconContainer ? copyIconContainer.querySelector("img") : null;

        if (copyIconImg) {
            fetch(copyIconImg.src)
                .then(response => response.text())
                .then(svgContent => {
                    copyIconImg.outerHTML = svgContent;

                    // Now animate the right file being copied from left file position
                    const rightFile = document.querySelector("#copy-icon .right-file");

                    if (rightFile) {
                        // Create a looping timeline
                        const copyTimeline = gsap.timeline({
                            repeat: -1,
                            repeatDelay: 0.5
                        });

                        copyTimeline
                            // Start at left file position (translate left by ~15px, up by ~14px)
                            .set(rightFile, { x: -15, y: -14, opacity: 0.3 })
                            // Fade in and move to final position
                            .to(rightFile, {
                                x: 0,
                                y: 0,
                                opacity: 1,
                                duration: 1,
                                ease: "power2.out"
                            })
                            // Hold at final position
                            .to(rightFile, {
                                duration: 0.8
                            });

                        // Optional: API to control copy animation
                        window.copyFlowAnimation = {
                            start: () => copyTimeline.play(),
                            stop: () => {
                                copyTimeline.pause();
                                gsap.set(rightFile, { x: 0, y: 0, opacity: 1 });
                            }
                        };
                    }
                });
        }
    </script>
</body>
</html>